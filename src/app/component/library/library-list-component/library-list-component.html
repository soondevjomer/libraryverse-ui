<h2
  class="text-2xl text-center md:text-left md:text-3xl font-bold text-[var(--color-brand1)] border-b-4 border-[var(--color-brand2)] pb-2 mb-6 tracking-wide uppercase"
>
  Library List
</h2>

<!-- FILTERS & TOGGLES -->
<form
  [formGroup]="filterForm"
  class="flex flex-col md:flex-row md:items-center md:justify-between bg-white p-4 rounded-2xl shadow-md border border-gray-200 mb-6 gap-4"
>
  <!-- LEFT SECTION -->
  <div class="flex flex-col sm:flex-row items-center gap-3 w-full md:w-auto">
    <input
      type="text"
      placeholder="Search libraries..."
      formControlName="searchName"
      (keydown)="onSearchKeyDown($event)"
      class="border border-gray-300 rounded-md px-4 py-2 w-full sm:w-64 focus:outline-none focus:ring-2 focus:ring-[var(--color-brand2)]"
    />

    <select
      formControlName="sortBy"
      (change)="onSortChange()"
      class="border border-gray-300 rounded-md px-3 py-2 focus:ring-2 focus:ring-[var(--color-brand2)]"
    >
      @for (sortKey of sortKeys; track $index) {
      <option [value]="sortKey">{{ SortBy[sortKey] }}</option>
      }
    </select>

    <button
      type="button"
      (click)="toggleSortDirection()"
      class="bg-[var(--color-brand2)] text-white px-4 py-2 rounded-md hover:bg-[var(--color-brand3)] transition"
    >
      {{ filterForm.get('sortDirection')?.value === 'ASC' ? 'â†“ Desc' : 'â†‘ Asc' }}
    </button>
  </div>

  <!-- RIGHT SECTION (Librarian Only) -->
  @if (isLoggedIn() && role() === Role.Librarian) {
  <div class="flex items-center gap-3">
    <button
      type="button"
      (click)="toggleLibraryViewMode()"
      class="border border-[var(--color-brand2)] text-[var(--color-brand2)] hover:bg-[var(--color-brand2)] hover:text-white px-4 py-2 rounded-md transition"
    >
      {{
        libraryViewMode() === 'allLibraries' ? 'Switch to My Library' : 'Switch to All Libraries'
      }}
    </button>

    <button
      type="button"
      (click)="toggleViewMode()"
      class="border border-[var(--color-brand2)] text-[var(--color-brand2)] hover:bg-[var(--color-brand2)] hover:text-white px-4 py-2 rounded-md transition"
    >
      {{ viewMode() === 'card' ? 'Switch to Table View' : 'Switch to Card View' }}
    </button>
  </div>
  }
</form>

<!-- ðŸ”¹ MAIN LIBRARY DISPLAY -->
@if (libraryPage$ | async; as libraryPage) { @if (libraryPage.content.length > 0) {
<!-- TABLE VIEW -->
@if (viewMode() === 'table') {
<!-- MOBILE VIEW (cards) -->
<div class="md:hidden space-y-4">
  @for (library of libraryPage.content; track library.id) {
  <div class="bg-white border border-gray-200 rounded-xl shadow-sm p-4 flex flex-col gap-2">
    <div class="flex justify-between items-center">
      <h3 class="font-semibold text-[var(--color-brand1)]">
        {{ library.name || 'Unnamed Library' }}
      </h3>
    </div>

    <p class="text-sm text-gray-700">
      <span class="font-medium">Location:</span>
      {{ library.address || 'N/A' }}
    </p>

    <div class="flex justify-end gap-2 mt-3">
      <button
        (click)="handleOnView(library)"
        class="flex items-center gap-1 px-3 py-1.5 bg-[var(--color-brand2)] text-white text-sm rounded-md hover:bg-[var(--color-brand3)] transition-colors"
      >
        <lucide-icon name="eye" class="w-4 h-4"></lucide-icon>
        View
      </button>

      @if (role() === Role.Librarian) { @if (library.id === libraryId) {
      <button
        (click)="handleOnEdit(library)"
        class="flex items-center gap-1 px-3 py-1.5 bg-[var(--color-brand1)] text-[var(--color-brand4)] text-sm rounded-md hover:bg-[var(--color-brand2)] hover:text-white transition-colors"
      >
        <lucide-icon name="pencil" class="w-4 h-4"></lucide-icon>
        Edit
      </button>
      } }
    </div>
  </div>
  }
</div>

<!-- DESKTOP TABLE -->
<div class="hidden md:block overflow-x-auto bg-white rounded-2xl shadow-md border border-gray-200">
  <table class="min-w-full text-sm text-left text-gray-700">
    <thead class="bg-[var(--color-brand1)] text-white uppercase text-xs">
      <tr>
        <th class="px-6 py-3 font-semibold w-12 text-center">#</th>
        <th class="px-6 py-3 font-semibold">Library Name</th>
        <th class="px-6 py-3 font-semibold">Location</th>
        <th class="px-6 py-3 font-semibold">Contact Number</th>
        <th class="px-6 py-3 font-semibold text-center">Actions</th>
      </tr>
    </thead>
    <tbody>
      @for (library of libraryPage.content; track $index) {
      <tr class="border-b hover:bg-gray-50 transition-all duration-200">
        <td class="px-6 py-3 text-center font-semibold text-gray-700">
          {{ libraryPage.pageNumber * libraryPage.pageSize + $index + 1 }}
        </td>

        <td class="px-6 py-3 font-semibold text-[var(--color-brand1)] truncate">
          {{ library.name || 'Unnamed Library' }}
        </td>

        <td class="px-6 py-3">
          {{ library.address || 'N/A' }}
        </td>

        <td class="px-6 py-3">
          {{ library.contactNumber || 'N/A' }}
        </td>

        <td class="px-6 py-3">
          <div class="flex flex-col items-center justify-end gap-2">
            <button
              (click)="handleOnView(library)"
              class="flex items-center justify-center gap-1 w-24 px-3 py-1.5 bg-[var(--color-brand2)] text-white text-sm rounded-md hover:bg-[var(--color-brand3)] transition-colors"
            >
              View
            </button>
            @if (role() == Role.Librarian && libraryId == library.id) {
            <button
              (click)="handleOnEdit(library)"
              class="flex items-center justify-center gap-1 w-24 px-3 py-1.5 bg-[var(--color-brand1)] text-[var(--color-brand4)] text-sm rounded-md hover:bg-[var(--color-brand2)] hover:text-white transition-colors"
            >
              Edit
            </button>
            }
          </div>
        </td>
      </tr>
      }
    </tbody>
  </table>
</div>
}

<!-- CARD VIEW -->
@else {
<div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
  @for (library of libraryPage.content; track library.id) {
  <app-library-card-component
    [library]="library"
    [libraryId]="libraryId"
    [role]="role()"
    (view)="handleOnView($event)"
    (edit)="handleOnEdit($event)"
  ></app-library-card-component>
  }
</div>
}

<div class="mt-6">
  <app-pagination-component
    [pageNumber]="libraryPage.pageNumber"
    [pageTotal]="libraryPage.totalPage"
    (pageChange)="handlePageChange($event)"
  ></app-pagination-component>
</div>
} @else {
<p class="text-gray-500 italic text-center py-8">No libraries found.</p>
} } @else {
<div class="animate-pulse space-y-3">
  <div class="h-6 bg-gray-300 rounded w-1/4"></div>
  <div class="bg-gray-200 h-40 rounded-2xl"></div>
  <p class="text-gray-500 italic">Loading libraries...</p>
</div>
}
