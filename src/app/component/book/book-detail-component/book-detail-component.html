<div
  class="flex items-center gap-4 mb-8 border-b-4 border-[var(--color-brand2)] pb-2"
>
  <button
    (click)="backToBookList()"
    class="bg-[var(--color-brand2)] hover:bg-[var(--color-brand3)] transition-colors duration-200 rounded-full w-10 h-10 flex items-center justify-center shadow-md"
  >
    <lucide-icon name="chevron-left" class="w-6 h-6 text-white"></lucide-icon>
  </button>

  <h2
    class="text-2xl md:text-3xl font-bold text-[var(--color-brand1)] tracking-wide uppercase"
  >
    Book Detail
  </h2>
</div>

@if (book$ | async; as book) {
  @if (book && book.bookDetail) {
    <div
      class="max-w-6xl mx-auto bg-[var(--color-brand6)] rounded-3xl shadow-lg overflow-hidden border border-[var(--color-brand3)]/30"
    >
      <div
        class="flex flex-col md:flex-row items-stretch bg-gradient-to-br from-[var(--color-brand4)] to-[var(--color-brand6)]"
      >
        <!-- Book Cover -->
        <div
          class="w-full md:w-1/3 flex items-center justify-center p-6 bg-[var(--color-brand6)] "
        >
          <img
            [src]="
              book.bookDetail.bookCover
                ? baseUrl + book.bookDetail.bookCover
                : 'default-book-cover.webp'
            "
            alt="{{ book.bookDetail.title }}"
            class="max-h-[500px] w-auto object-contain rounded-xl shadow-md transition-transform duration-300 hover:scale-[1.02]"
          />
        </div>

        <!-- Book Info -->
        <div class="flex-1 flex flex-col justify-between p-8 space-y-6">
          <div class="space-y-3">
            <!-- Title -->
            <h1
              class="text-3xl md:text-4xl font-bold text-[var(--color-brand1)] leading-tight"
            >
              {{ book.bookDetail.title }}
            </h1>
            @if (book.bookDetail.seriesTitle) {
              <p
                class="text-[var(--color-brand3)] font-medium italic text-sm"
              >
                ({{ book.bookDetail.seriesTitle }})
              </p>
            }

            <!-- Authors & Genres -->
            <div class="text-gray-700 text-sm space-y-1">
              <p>
                <span
                  class="font-semibold text-[var(--color-brand1)]"
                  >Authors:</span
                >
                {{ book.bookDetail.authors?.join(', ') || 'Unknown' }}
              </p>
              @if (book.bookDetail.genres?.length) {
                <p>
                  <span
                    class="font-semibold text-[var(--color-brand1)]"
                    >Genres:</span
                  >
                  {{ book.bookDetail.genres?.join(', ') }}
                </p>
              }
            </div>

            <!-- Description -->
            <div class="pt-2">
              <h3
                class="text-lg font-semibold text-[var(--color-brand1)] mb-1"
              >
                Description
              </h3>
              <p
                class="text-gray-700 leading-relaxed whitespace-pre-line max-h-40 overflow-y-auto"
              >
                {{ book.bookDetail.description || 'No description available.' }}
              </p>
            </div>
          </div>

          <!-- Meta Details -->
          <div
            class="grid grid-cols-2 sm:grid-cols-3 gap-x-6 gap-y-2 text-sm text-gray-700 border-t border-[var(--color-brand3)]/20 pt-4"
          >
            <p>
              <span class="font-semibold text-[var(--color-brand1)]"
                >Publisher:</span
              >
              {{ book.bookDetail.publisher || 'N/A' }}
            </p>
            <p>
              <span class="font-semibold text-[var(--color-brand1)]"
                >Year:</span
              >
              {{ book.bookDetail.publishedYear || 'N/A' }}
            </p>
            <p>
              <span class="font-semibold text-[var(--color-brand1)]"
                >ISBN:</span
              >
              {{ book.isbn }}
            </p>
            <p>
              <span class="font-semibold text-[var(--color-brand1)]"
                >Stock:</span
              >
              {{ book.inventory?.availableStock ?? 0 }}
            </p>
          </div>

          <!-- Price & Actions -->
          <div
            class="flex flex-col sm:flex-row justify-between items-center gap-4 border-t border-[var(--color-brand3)]/30 pt-6"
          >
            <p
              class="text-3xl font-bold text-[var(--color-brand1)]"
            >
              â‚±{{ book.bookDetail.price | number: '1.2-2' }}
            </p>

            <div class="flex gap-3">
              @if (role == Role.Librarian) {
                <button
                  (click)="handleOnEdit(book.id)"
                  class="px-5 py-2 bg-[var(--color-brand2)] text-white font-medium rounded-lg hover:bg-[var(--color-brand3)] transition-all shadow-sm"
                >
                  Edit
                </button>
              } @else if(role == Role.Reader) {
                <button
                  (click)="handleOnAddToCart(book.id)"
                  class="px-5 py-2 bg-[var(--color-brand2)] text-white font-medium rounded-lg hover:bg-[var(--color-brand3)] transition-all shadow-sm"
                >
                  Add to Cart
                </button>
                <button
                  (click)="handleOnBuy(book)"
                  class="px-5 py-2 bg-[var(--color-brand1)] text-white font-medium rounded-lg hover:bg-[var(--color-brand2)] transition-all shadow-sm"
                >
                  Buy Now
                </button>
              }
            </div>
          </div>
        </div>
      </div>
    </div>
  } @else {
    <p class="text-gray-500 italic text-center py-8">
      No book detail found.
    </p>
  }
} @else {
  <div class="animate-pulse max-w-4xl mx-auto px-4 py-8 space-y-4">
    <div class="h-8 bg-gray-300 rounded w-1/4"></div>
    <div class="bg-gray-200 h-72 rounded-2xl"></div>
    <p class="text-gray-500 italic">Loading book details...</p>
  </div>
}
