<h2
  class="text-2xl text-center md:text-left md:text-3xl font-bold text-[var(--color-brand1)] border-b-4 border-[var(--color-brand2)] pb-2 mb-6 tracking-wide uppercase"
>
  My Orders
</h2>

<!-- Status Filter -->
<div class="mb-4 flex flex-wrap gap-3 justify-center md:justify-start">
  @for (status of orderStatuses; track status) {
  <button
    (click)="setStatusFilter(status)"
    class="px-4 py-1 rounded font-semibold transition-all duration-200"
    [ngClass]="
      statusFilter() === status
        ? 'bg-brand2 text-white shadow-md scale-105'
        : 'bg-brand4 text-brand1 hover:bg-brand3 hover:text-white'
    "
  >
    {{ status }}
  </button>
  }
</div>

<!-- Orders Table -->
<div class="overflow-x-auto bg-white rounded-2xl shadow-md border border-[var(--color-brand3)]">
  @if (orders().length > 0) {
  <table class="w-full text-sm text-left border-collapse">
    <thead class="bg-[var(--color-brand1)] text-white">
      <tr>
        <th class="px-4 py-2">#</th>
        <th class="px-4 py-2">Order ID</th>
        <th class="px-4 py-2">Status</th>
        <th class="px-4 py-2 text-right">Total</th>
        <th class="px-4 py-2 text-center rounded-tr-2xl">Actions</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-[var(--color-brand3)]">
      @for (order of orders(); track order.id) {
      <tr class="hover:bg-[var(--color-brand3)]/10 transition-colors">
        <td class="px-4 py-2">{{ currentPage() * pageSize + $index + 1 }}</td>
        <td class="px-4 py-2 font-medium text-brand1">#{{ order.id }}</td>
        <td class="px-4 py-2">
          <span
            class="px-2 py-1 rounded text-xs font-semibold"
            [ngClass]="{
              'bg-yellow-100 text-yellow-800': order.orderStatus === 'PENDING',
              'bg-blue-100 text-blue-800': order.orderStatus === 'SHIPPED',
              'bg-green-100 text-green-800': order.orderStatus === 'DELIVERED',
              'bg-red-100 text-red-800': order.orderStatus === 'CANCELLED'
            }"
          >
            {{ order.orderStatus }}
          </span>
        </td>
        <td class="px-4 py-2 text-right font-semibold">₱{{ order.subtotal | number : '1.2-2' }}</td>
        <td class="px-4 py-2 text-center">
          <button
            (click)="toggleExpand(order.id)"
            class="px-2 py-1 rounded bg-brand2 text-brand4 hover:bg-brand3 transition"
          >
            {{ isExpanded(order.id) ? 'Hide' : 'View' }}
          </button>
        </td>
      </tr>

      @if (isExpanded(order.id)) {
      <tr>
        <td colspan="7" class="p-0 border-0">
          <div class="bg-[var(--color-brand4)] p-4 rounded-b-2xl transition-all duration-300">
            <table class="w-full text-sm border-collapse">
              <thead>
                <tr class="border-b border-[var(--color-brand3)]">
                  <th class="text-left py-2 px-3">Quantity</th>
                  <th class="text-left py-2 px-3">Book Name</th>
                  <th class="text-right py-2 px-3">Price</th>
                </tr>
              </thead>
              <tbody>
                @for (item of order.orderItems; track $index) {
                <tr class="border-b border-[var(--color-brand3)] last:border-0">
                  <td class="py-2 px-3 font-semibold">{{ item.quantity }}</td>
                  <td class="py-2 px-3">{{ item.bookName }}</td>
                  <td class="py-2 px-3 text-right">₱{{ item.price | number : '1.2-2' }}</td>
                </tr>
                }
              </tbody>
            </table>

            <div class="mt-3 flex justify-end gap-2">
              <!-- Reader can cancel pending -->
              @if (!isLibrarian() && order.orderStatus === 'PENDING') {
              <button
                (click)="cancelOrder(order.id)"
                class="px-4 py-1.5 rounded bg-red-600 text-white hover:bg-red-500 transition"
              >
                Cancel
              </button>
              }

              <!-- Librarian actions -->
              @if (isLibrarian()) { @if (order.orderStatus === 'PENDING') {
              <button
                (click)="cancelOrder(order.id)"
                class="px-4 py-1.5 rounded bg-red-600 text-white hover:bg-red-500 transition"
              >
                Cancel
              </button>
              <button
                (click)="markAsShipped(order.id)"
                class="px-4 py-1.5 rounded bg-brand1 text-white hover:bg-brand3 transition"
              >
                Mark as shipped
              </button>
              } @if (order.orderStatus === 'SHIPPED') {
              <button
                (click)="markAsDelivered(order.id)"
                class="px-4 py-1.5 rounded bg-brand1 text-white hover:bg-brand3 transition"
              >
                Mark as delivered
              </button>
              } }
            </div>
          </div>
        </td>
      </tr>
      } }
    </tbody>
  </table>
  } @else {
  <p class="text-gray-500 italic text-center py-8">No orders found.</p>
  }
</div>

<!-- Pagination -->
<app-pagination-component
  [pageNumber]="currentPage()"
  [pageTotal]="totalPages()"
  (pageChange)="onPageChange($event)"
>
</app-pagination-component>
